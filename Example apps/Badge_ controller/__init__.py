# https://learn.adafruit.com/ir-sensor/circuitpython


import board
import pulseio
import adafruit_irremote

IR_PIN = board.IR_RECV # Pin connected to IR receiver.

# Expected pulse, pasted in from previous recording REPL session:
#pulse = [8994, 4485, 549, 594, 546, 591, 549, 591, 549, 591, 549, 591, 549, 591, 549, 591, 546, 594, 546, 1716, 546, 1713, 549, 1713, 549, 1713, 552, 1710, 549, 1713, 570, 1692, 573, 570, 546, 1716, 570, 1692, 549, 594, 546, 1713, 549, 1713, 549, 591, 570, 570, 570, 570, 549, 591, 549, 591, 546, 1713, 549, 594, 567, 570, 549, 1713, 570, 1692, 549, 1713, 549]
IR_a_RCV = [9525, 4473, 573, 531, 576, 513, 564, 540, 558, 546, 555, 546, 531, 573, 549, 555, 549, 555, 573, 1671, 561, 1695, 549, 1713, 549, 1689, 534, 1728, 573, 1671, 558, 546, 552, 1704, 549, 558, 573, 531, 570, 519, 558, 543, 558, 546, 531, 570, 573, 531, 573, 534, 549, 1692, 561, 1695, 573, 1689, 573, 1668, 534, 1725, 576, 1671, 558, 1695, 573]
IR_b_RCV = [9528, 4470, 579, 528, 549, 555, 576, 528, 579, 528, 552, 534, 534, 570, 531, 573, 531, 570, 486, 1773, 555, 1689, 531, 1725, 555, 1689, 537, 1719, 579, 1683, 576, 534, 540, 1695, 519, 585, 579, 1683, 576, 510, 537, 567, 531, 573, 483, 621, 519, 582, 552, 555, 552, 1689, 537, 567, 531, 1728, 579, 1662, 564, 1695, 552, 1710, 576, 1665, 531]
IR_left_RCV = [9483, 4515, 531, 573, 483, 621, 519, 582, 552, 555, 552, 552, 552, 555, 576, 510, 537, 564, 534, 1725, 576, 1686, 549, 1692, 531, 1728, 576, 1665, 531, 1728, 552, 552, 579, 1665, 531, 1725, 552, 552, 552, 555, 576, 1665, 531, 1725, 552, 555, 576, 1665, 534, 573, 480, 1776, 552, 552, 576, 1668, 531, 1725, 552, 1689, 540, 1719, 552, 1710, 552]
IR_right_RCV = [9510, 4491, 558, 546, 555, 546, 573, 531, 576, 531, 573, 531, 573, 534, 573, 513, 585, 519, 558, 1695, 576, 1671, 588, 1668, 534, 1725, 576, 1668, 558, 1698, 576, 531, 573, 1671, 558, 1695, 576, 1671, 588, 519, 558, 543, 558, 1698, 576, 1671, 582, 522, 558, 546, 555, 1701, 573, 531, 576, 1665, 558, 1701, 573, 1674, 582, 1671, 573, 1689, 576]
IR_up_RCV = [9510, 4491, 558, 546, 573, 531, 573, 534, 573, 531, 573, 531, 573, 534, 540, 546, 555, 546, 558, 1701, 573, 1671, 558, 1695, 576, 1671, 588, 1668, 555, 1707, 573, 531, 573, 1668, 558, 1701, 573, 1671, 558, 1698, 573, 531, 573, 1674, 558, 546, 555, 1698, 576, 531, 573, 1671, 558, 546, 555, 1698, 576, 1671, 558, 1695, 576, 1689, 573, 1665, 558]
IR_down_RCV = [9513, 4491, 558, 546, 555, 546, 558, 546, 570, 531, 576, 531, 573, 531, 573, 534, 573, 516, 558, 1692, 576, 1686, 576, 1665, 561, 1698, 576, 1671, 558, 1695, 576, 531, 573, 1671, 561, 1692, 576, 1686, 576, 1665, 561, 1698, 576, 1671, 558, 1695, 576, 1686, 576, 516, 558, 1692, 576, 531, 573, 1674, 585, 1668, 573, 1686, 576, 1668, 558, 1698, 576]
IR_menu_RCV = [9525, 4473, 576, 531, 573, 9525, 582, 519, 558, 543, 558, 546, 558, 543, 576, 531, 573, 534, 570, 1671, 558, 1695, 576, 1686, 576, 1665, 561, 1698, 576, 1668, 561, 546, 555, 1698, 576, 534, 573, 1668, 558, 1698, 576, 531, 573, 1668, 558, 546, 558, 570, 546, 558, 546, 1689, 573, 519, 555, 1695, 576, 1686, 576, 1665, 561, 1698, 576, 1668, 561]

print('IR listener')
# Fuzzy pulse comparison function:
def fuzzy_pulse_compare(pulse1, pulse2, fuzzyness=0.2):
    if len(pulse1) != len(pulse2):
        return False
    for i in range(len(pulse1)):
        threshold = int(pulse1[i] * fuzzyness)
        if abs(pulse1[i] - pulse2[i]) > threshold:
            return False
    return True

# Create pulse input and IR decoder.
pulses = pulseio.PulseIn(IR_PIN, maxlen=200, idle_state=True)
decoder = adafruit_irremote.GenericDecode()
pulses.clear()
pulses.resume()
# Loop waiting to receive pulses.
while True:
    # Wait for a pulse to be detected.
    detected = decoder.read_pulses(pulses)
    #print('got a pulse...')
    print(detected)
    # Got a pulse, now compare.
    if fuzzy_pulse_compare(IR_a_RCV, detected):
        print('A')
    if fuzzy_pulse_compare(IR_b_RCV, detected):
         print('B')
    if fuzzy_pulse_compare(IR_left_RCV, detected):
        print('Left')
    if fuzzy_pulse_compare(IR_right_RCV, detected):
        print('Right')
    if fuzzy_pulse_compare(IR_up_RCV, detected):
        print('UP')
    if fuzzy_pulse_compare(IR_down_RCV, detected):
        print('Down')
    if fuzzy_pulse_compare(IR_menu_RCV, detected):
        print('Menu')